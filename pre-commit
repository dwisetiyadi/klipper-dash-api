#!/bin/sh

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep ".*\.\(ts\|tsx\)")
ESLINT="$(git rev-parse --show-toplevel)/node_modules/.bin/eslint"

if [[ "$STAGED_FILES" = "" ]]; then
  exit 0
fi

PASS=true

printf "\nSebelum dicommit, kode JS nya divalidasi dulu ya gan. Untuk info lebih jelas boleh tanya dwi.setiyadi@gmail.com\n"
printf "\nValidasi dimulai\n"

# Cek eslint
if [[ ! -x "$ESLINT" ]]; then
  printf "\t\033[41mBelum install ESlint, install dengan perintah:\033[0m npm i --save-dev eslint\n\n"
  exit 1
fi

for FILE in $STAGED_FILES
do
  "$ESLINT" "$FILE"

  if [[ "$?" == 0 ]]; then
    printf "\t$FILE \033[32mLOLOS\033[0m\n"
  else
    printf "\t$FILE \033[31mGAGAL\033[0m\n"
    PASS=false
  fi
done

printf "\nValidasi kode selesai\n\n"

if ! $PASS; then
  # printf "\033[41mCOMMIT FAILED:\033[0m Your commit contains files that should pass ESLint but do not. Please fix the ESLint errors and try again.\n\n"
  printf "\033[0;31m"
  cat << "EOF"
      .....,,,,,,,,,***.........,,/////(/////,.........***,,,,,,,.....         
    ......,**********///,,,,,,****##########(***,,,,,.///*****,,,,,.           
   ......,,*/////////((((****                 .*//***/((///******,.            
   ....,       ,(((######    ...,,,,,.,,,,,,,,,.    .###(((////**........      
  ....,.  ,,,,,.  *%%%.   .,,,,,,,,,,,,,.   .,,,,,,,   ,###(((/,.............  
......,,,  ,,,,,,,,.   ,,,,,, *&&&&%#&&,...,,,,,,  .,,,   /##(**,,,,,,,,,...,,.
.,,,...,,*   ,,,,,,,,,,,,,,*/&&&&(,   .,,,,,,,&&&& .,,,.  ///////*,,..,,**,,,
,,,,***,,,*//. .,,,,,,,,,,,,**  ##*## ,,,,,,,,.,(&&&&&%.,,.      ..,,,,.   **,,
,,,***///*,*/((   ,,,,,,,,,,. .,,,,,,.,,,,,,,, /(/ .%&,,,,,,,,,,,,,,,,,  /**,
,,***///((##//  .,,,,,,,,..,,,,,,,,,,,,..,,,..,. .#  .,,,,,,,,,,,,,,,,   *//%@&
,****//(%@##%/ .,,,,,,,,,,,, ,,,,,,,,,,...,,,,,,,,,,,,,,,,,,,,,,.    .(#((///**
***///..,/#%%  .,,,,,,,,,,,,, ,,,,,,,,.....,,,,,  ...,,,,,,,,,  #&&%%%#((/**((/
.,*///(/,./%&*..,,,,,,,,,,,.,,,,,,,,,,,,,,,,.,,.,,,,,,,,,,,,. ,(.(%(.*(##(/*,
  ....*(##%%&  .,..##,,,,,,,,,,,,,..,,,,.,,,,,,,,,,,,,,,,,,,.*&.%&%%#/******,
 ......,,@@#%  .,,,,,,.,/. ..,#%/             .,,,,,,,,,,,,,,*.  &%((///******,
......,,,(//(  .,,,..%%&&&&&&&&&&%            %&&&&&&&&&&.*,,,  .,/(((/*,,,  .*
..     ....,/#%&&,.&&&&&&&&&&(&&&&&&%*    ,#&&&&&&&&&&&&&&&&&,.  ##((////******
****,,,,**//*  ..%&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&((&&&&&&&&&  ##((/////////(
///*.,*/*..,,  ,&&&&&&&&&&&&&&&%&&&&&&&&&&&&&&%&&&&&&&&&&&&&&*.*(%&&&&%/.(####(
(((###%%%%&&&. %/&&&&%*&&&&&&&&&&&&&&(&&&&&&&&&&/&&&&&&&.&&&&(%  &&&&%#,,&&&/*(
(((###%%%%&**# &&%&&&&&% %&&&*%&&&&&% &&&&&&&%&&&&&&%&&&&&&,.&( ,&&&&%%%%##,..(
(((####%#,*#&, && *%%%&&&&&&&&&&&&%(   %&&&&&&&&&%&&&&&   (&, (&&&%%%###(((//
(((((/,*.//((  &%     /#%%%%%%%%(.      (%%&&&&&&&&%#,      %&  /*,,..,,*/////*
,,,*  ***//((       @@@@@@(@@@@%@@@%@@@@@@*.           ,&&  /*,....        
,,,,,*****//(  &(     @@@@@*  /,  .(. .#(. @@@@@@*         % ,*,,...         
..... ...,,/# .&(     @@@&                 *@@@@&          &&. &*..          
      ./(##%% .      ,       ..,,,,,..     /#.          (&&  &%%###(@@*      
 .*////((##%% .&&          ,,*///////////*,,,   ,         & /%%###((((///,.  
****//@@@(##% .&&     .&  ,//////////////////, /@@       %&&. %%%##(((////*****
,,****//((##% .&&%    @@ ,.//////////////////* @@@      %&  *(##(((////****,,
,,,***///((#(  &&&%   @@@@@*##,/*.*//////.(* @@@@@    *&&&&  **,,,((////****,,,
,,,,***//*,,*  %&&&  /@@@@@@&@@@& %@@.%@@@@@@@,   /&&&&&/ ,@*,..  ./*****,,,,
.,,,,**....,,*  %&&&&&%    (&@@@@@@@@@@@@@@@@,   ,&&&&&&%%  /*,...    .***,,,,.
..,,.    ...,,*  #%&&&&&&.                .(&&&&&&&&%#.  #/,...        .,,,..
..        ...,,*. .%%&&&&&&&&&&&&&%%%%&&&&&&&&&&&&&&%/  .##((/..            ...
           ...,((#   %%&&&&&&&&&&&&&&&&&&&&&&&&&&%(   ###(((///.   *%          
             ,*//(((.  (%%%%%%&&&&&&&&&&&&&&&%%(.  ,/#(((////****              
           .,,***//(@%(.     *(##%%%%%%%%#/.    ***,,*////*****,,,.            
          .,,,,,,***///(*****,.           .#@**,,,,...******,,,,,,,.           

 __  __           _ _                                                    _ 
|  \/  |         (_) |                                                  | |
| \  / | __ _ ___ _| |__     ___ _ __ _ __ ___  _ __    __ _  __ _ _ __ | |
| |\/| |/ _` / __| | '_ \   / _ \ '__| '__/ _ \| '__|  / _` |/ _` | '_ \| |
| |  | | (_| \__ \ | | | | |  __/ |  | | | (_) | |    | (_| | (_| | | | |_|
|_|  |_|\__,_|___/_|_| |_|  \___|_|  |_|  \___/|_|     \__, |\__,_|_| |_(_)
                                                        __/ |              
                                                       |___/               

EOF
  printf "\033[0m"
  exit 1
else
  printf "\033[0;32m"
  cat << "EOF"
┈┈┈┈┈┈▕▔╲
┈┈┈┈┈┈┈▏▕
┈┈┈┈┈┈┈▏▕▂▂▂
▂▂▂▂▂▂╱┈▕▂▂▂▏
▉▉▉▉▉┈┈┈▕▂▂▂▏
▉▉▉▉▉┈┈┈▕▂▂▂▏
▔▔▔▔▔▔╲▂▕▂▂▂I

 __  __             _        _                         _ 
|  \/  |           | |      | |                       | |
| \  / | __ _ _ __ | |_ __ _| |__     __ _  __ _ _ __ | |
| |\/| |/ _` | '_ \| __/ _` | '_ \   / _` |/ _` | '_ \| |
| |  | | (_| | | | | || (_| | |_) | | (_| | (_| | | | |_|
|_|  |_|\__,_|_| |_|\__\__,_|_.__/   \__, |\__,_|_| |_(_)
                                      __/ |              
                                     |___/               

EOF
  printf "\033[0m"
fi

exit $?
